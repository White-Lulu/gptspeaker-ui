<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaker-OwO</title>
    <style>
        .container {
    display: flex;
}

input, textarea {
    font-family: Arial, sans-serif;
}

.navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 2px solid #ccc; /* 只显示下边框 */
        }

.emoji {
    font-size: 24px; /* 表情大小 */
    margin-right: 10px; /* 右侧间距 */
}

.nav-links {
    display: flex;
    gap: 15px; /* 文字块之间的间距 */
}

.nav-links .active-nav {
        border: 2px solid;  /* 添加边框 */
        border-radius: 5px; /* 保持与其他按钮一致的圆角 */
        color: black;       /* 保持文字颜色 */
}

.nav-links .noactive-nav {
                border: 2px solid;  /* 添加边框 */
                border-radius: 5px; /* 保持与其他按钮一致的圆角 */
                color: black;       /* 保持文字颜色 */
        }
    
.nav-links a {
    text-decoration: none; /* 去掉超链接的下划线 */
    color: black; /* 文字颜色 */
    font-size: 16px;
    padding: 5px 10px; /* 内边距 */
}

.nav-links4{
     /* 只有最后一个有背景色 */
    color:#ffffff;
    border-radius: 5px; /* 让按钮圆角 */
    border: 2px solid;  /* 添加边框 */
    border-radius: 5px; /* 保持与其他按钮一致的圆角 */
    color: rgb(255, 255, 255);       /* 保持文字颜色 */
}

.output {
    flex: 2; /* 左侧较大 */
    background: #f4f4f4;
    padding: 15px;
    border-radius: 10px;
    min-height: 400px;
    overflow-y: auto;
    border:2px solid #ccc
}

.input-section, .note-section {
    flex: 1; /* 右侧小一些 */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

textarea {
    width: 100%;
    padding: 10px;
    border:2px solid #ccc;
    border-radius: 5px;
    resize: none;
}
/* 主容器 */
.container {
    display: flex;
    gap: 30px;
    margin-top: 20px;
    padding: 20px;
    min-height: 400px; /* 让整体区块更长 */
}

/* 第一列（左侧） */
.left-column {
    flex: 4;
    background-color: #dddddd;
    padding: 20px;
    border-radius: 5px;
    min-height: 580px; /* 左侧区块至少 400px 高 */
    border:2px solid #ccc;
    white-space: pre-wrap; /* 保留换行符和空格 */
    overflow-y: auto;    /* 修改这里：使用 auto 而不是 true */
    max-height: 480px;   /* 添加这行：限制最大高度 */
}

/* 第二列（右侧，包含两行） */
.right-column {
    flex: 3;
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.right-down {
    display: flex;
    flex-direction: column; /* 让内部内容垂直排列 */
    gap: 25px; /* 上下间距 */
    flex: 3;
    padding:0px;
    border-radius: 5px;
    min-height: 330px; /* 让右侧每个区块至少 180px 高 */
}
.multi-line-input {
    flex: 3; /* 让多行输入框占据较多空间 */
    padding: 10px;
    font-size: 16px;
    background-color: #ffffff;
    border:2px solid #ccc;
    border-radius: 5px;
    width: 100%; /* 确保宽度不超出父容器 */
    box-sizing: border-box; /* 让 padding 不会撑大宽度 */
    resize: none; /* 禁止拖动，防止超出 */
    
}

.bottom-row {
    display: flex;
    gap: 25px; /* 控件间距 */
    align-items: center;
}

.single-line-input {
    flex: 2; /* 让输入框占据可用空间 */
    background-color: #ffffff;
    padding: 8px;
    font-size: 14px;
    border:2px solid #ccc;
    border-radius: 5px;
}

.action-btn1 {
    padding: 8px 12px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    color: white;
}

.action-btn2 {
    padding: 8px 12px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    color: white;
}
.right-top {
    flex: 3;
    padding: 0px;
    border-radius: 5px;
    min-height: 120px; /* 保持足够高度 */
    display: flex;
    gap: 25px;
    align-items: stretch; /* 让输入框和按钮组填充整个高度 */
}

.prompt-input {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    border:2px solid #ccc;
    background-color: #ffffff;
    border-radius: 5px;
    height: 100%; /* 确保宽度不超出父容器 */
    box-sizing: border-box; /* 让 padding 不会撑大宽度 */
    resize: none; /* 禁止拖动，防止超出 */
}

.button-group {
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* 让按钮均匀分布 */
    gap: 25px;
    height: 100%; /* 让按钮组填充整个高度 */
}

button {
    flex: 1; /* 让每个按钮等高 */
    padding: 10px 15px;
    font-size: 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.confirm-btn {
    color: rgb(255, 255, 255);
}

.deepseek-btn {
    background-color: #2360e3;
    color: white;
}

.openai-btn {
    background-color: #0b4267;
    color: white;
}

    </style>
</head>
<body>
    <div class="navbar">
        <span class="emoji">😊</span> <!-- 左侧表情 -->
        <div class="nav-links">
            <a href="#" class="active-nav">Speaker</a>
            <a href="news.html" class="noactive-nav">News</a>
            <a href="notes.html" class="noactive-nav">Notes</a>
            <a class="nav-links4" href="settings.html">Setting</a> <!-- 最后一个有底色 -->
        </div>
    </div>
     <!-- 主容器：包含两列 -->
     <div class="container">
        <!-- 第一列（左侧大区块） -->
        <div class="left-column" id="file-content">Waiting for submit</div>

        <!-- 第二列（右侧包含两行区块） -->
        <div class="right-column">
            <div class="right-top">
                <textarea class="prompt-input" placeholder="Here's your prompt"></textarea>
                <div class="button-group">
                    
                    <button class="deepseek-btn">DeepSeek</button>
                    <button class="openai-btn">OpenAI</button>
                    <button class="confirm-btn">— Submit ! —</button>
                </div>
            </div>
            <div class="right-down">
                <textarea class="multi-line-input" placeholder="Write down some notes"></textarea>
                <div class="bottom-row">
                    <input type="text" class="single-line-input" placeholder="Input notes' title">
                    <button class="action-btn1">Clear</button>
                    <button class="action-btn2">Submit !</button>
                </div>
            </div>
    </div>

    <script>
    
        // 页面加载时应用保存的设置
        window.onload = function() {
    const savedBackgroundColor = localStorage.getItem('backgroundColor') || '#f4f4f4';
    const savedMainColor = localStorage.getItem('mainColor') || '#447de18f';
    const savedSubColor = localStorage.getItem('subColor') || '#ccc';
    const savedOpacity = localStorage.getItem('opacity') || '1'; // 读取透明度
    
    

    // 清除所有按钮的 √
    document.querySelectorAll(".deepseek-btn, .openai-btn").forEach(btn => {
        btn.innerText = btn.innerText.replace(" √", "");
    });

    // 应用背景色
    document.body.style.backgroundColor = savedBackgroundColor;
    document.querySelectorAll('.noactive-nav').forEach(a => {
        a.style.borderColor = savedBackgroundColor;});

    // 应用主色
    document.querySelector('.confirm-btn').style.backgroundColor = savedMainColor;
    document.querySelector('.action-btn2').style.backgroundColor = savedMainColor;
    document.querySelector('.active-nav').style.borderColor = savedMainColor;

    // 应用辅助色
    document.querySelector('.navbar').style.borderBottomColor = savedSubColor;
    document.querySelector('.nav-links4').style.backgroundColor = savedSubColor;
    document.querySelector('.nav-links4').style.borderColor = savedSubColor;
    document.querySelector('.left-column').style.borderColor = savedSubColor;
    document.querySelector('.multi-line-input').style.borderColor = savedSubColor;
    document.querySelector('.single-line-input').style.borderColor = savedSubColor;
    document.querySelector('.prompt-input').style.borderColor = savedSubColor;
    document.querySelector('.action-btn1').style.backgroundColor = savedSubColor;

    // 计算背景颜色亮度并调整字体颜色
    document.querySelector('.nav-links4').style.color = getContrastColor(savedSubColor);
    document.querySelector('.action-btn1').style.color = getContrastColor(savedSubColor);

    // 应用透明度
    applyOpacity(savedOpacity);

     // 绑定滑动条事件，使用户调整时实时生效
     document.getElementById('opacity').addEventListener('input', function() {
        applyOpacity(this.value);
    });

    // 设置滑动条的值为保存的透明度
    document.getElementById('opacity').value = savedOpacity;

    

};

// 应用透明度
function applyOpacity(opacity) {
    document.querySelectorAll('.left-column, .prompt-input, .multi-line-input,.single-line-input').forEach(el => {
        // 先获取原始背景颜色
        let bgColor = window.getComputedStyle(el).backgroundColor;
        let rgbaColor = convertToRGBA(bgColor, opacity);
        el.style.backgroundColor = rgbaColor;
    });
}

// 颜色转换函数：将 `rgb(r, g, b)` 或 `#xxxxxx` 转换为 `rgba(r, g, b, opacity)`
function convertToRGBA(color, opacity) {
    let r, g, b;
    
    if (color.startsWith("rgb")) {
        // 解析 `rgb(r, g, b)` 形式
        let rgbValues = color.match(/\d+/g);
        r = parseInt(rgbValues[0]);
        g = parseInt(rgbValues[1]);
        b = parseInt(rgbValues[2]);
    } else if (color.startsWith("#")) {
        // 解析 `#RRGGBB` 形式
        let hex = color.replace("#", "");
        if (hex.length === 3) {
            hex = hex.split("").map(c => c + c).join("");
        }
        r = parseInt(hex.substring(0, 2), 16);
        g = parseInt(hex.substring(2, 4), 16);
        b = parseInt(hex.substring(4, 6), 16);
    } else {
        // 默认返回白色
        return `rgba(255, 255, 255, ${opacity})`;
    }
    
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}

// 计算颜色亮度并返回合适的对比色
function getContrastColor(hexColor) {
    // 确保 hexColor 是 #RRGGBB 形式
    hexColor = hexColor.replace(/^#/, '');
    if (hexColor.length === 3) {
        hexColor = hexColor.split('').map(c => c + c).join('');
    }

    // 解析 RGB 值
    let r = parseInt(hexColor.substring(0, 2), 16) / 255;
    let g = parseInt(hexColor.substring(2, 4), 16) / 255;
    let b = parseInt(hexColor.substring(4, 6), 16) / 255;

    // 计算相对亮度（符合 W3C WCAG 标准）
    let luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;

    // 亮度较高（背景较浅），用黑色；亮度较低（背景较深），用白色
    return luminance > 0.5 ? '#000000' : '#ffffff';

};

    </script>

<script>
    let selectedButton = null; // 记录当前选中的按钮

    function toggleButtonBorder(button) {
    if (selectedButton === button) {
        // 取消选中，移除 √
        button.innerText = button.innerText.replace(" √", ""); // 移除 √
        selectedButton = null;
    } else {
        // 先清除其他按钮的 √
        document.querySelectorAll(".deepseek-btn, .openai-btn").forEach(btn => {
            btn.innerText = btn.innerText.replace(" √", ""); // 移除 √
        });

        // 选中当前按钮，添加 √
        button.innerText = button.innerText + " √"; // 添加 √
        selectedButton = button;
    }
}

    document.querySelector(".deepseek-btn").addEventListener("click", function () {
        toggleButtonBorder(this);
    });

    document.querySelector(".openai-btn").addEventListener("click", function () {
        toggleButtonBorder(this);
    });

    // 发送数据到服务器
    async function submitPrompt() {
    const promptText = document.querySelector(".prompt-input").value.trim();
    if (!promptText) {
        alert("Please enter your prompt");
        return;
    }

    const selectedModel = selectedButton ? selectedButton.innerText.replace(" √", "").trim() : null;
    if (!selectedModel) {
        alert("Please select one of the models: DeepSeek or OpenAI");
        return;
    }

    await runScript();

    async function runScript() {
    try {
        // 使用完整的服务器URL
        const response = await fetch(`http://localhost:5000/submit_model_prompt`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            // 添加请求体，传递prompt内容
            body: JSON.stringify({
                model: selectedModel,
                prompt: document.querySelector(".prompt-input").value.trim()
            })
        });

        if (response.ok) {
            const result = await response.json();
            console.log("脚本运行成功:", result);
        } else {
            console.error("脚本运行失败:", response.statusText);
        }
    } catch (error) {
        console.error("请求错误:", error);
}
}

    
    }
    document.querySelector(".confirm-btn").addEventListener("click", submitPrompt);
</script>

<script>
    document.querySelector(".action-btn2").addEventListener("click", function () {
    const title = document.querySelector(".single-line-input").value.trim();
    const content = document.querySelector(".multi-line-input").value.trim();

    if (!title || !content) {
        alert("Please enter both title and content");
        return;
    }

    // 获取当前日期
    const date = new Date().toLocaleString();

    // 创建 note 对象
    const note = {
        title,
        content,
        date
    };

    // 从 localStorage 中读取现有的 notes
    const notes = JSON.parse(localStorage.getItem("notes")) || [];

    // 添加新的 note
    notes.push(note);

    // 保存到 localStorage
    localStorage.setItem("notes", JSON.stringify(notes));

    // 清空输入框
    document.querySelector(".single-line-input").value = "";
    document.querySelector(".multi-line-input").value = "";

    alert("Note saved successfully!");
});

document.querySelector(".action-btn1").addEventListener("click", function () {
    // 清空输入框
    document.querySelector(".single-line-input").value = "";
    document.querySelector(".multi-line-input").value = "";

});


    async function updateFileContent() {
        try {
            const response = await fetch("http://localhost:5000/read_txt");
            if (response.ok) {
                const result = await response.json();
                document.getElementById("file-content").textContent = result.content;
            } else {
                document.getElementById("file-content").textContent = "文件读取失败";
            }
        } catch (error) {
            document.getElementById("file-content").textContent = "请求错误：" + error;
        }
    }

    // 每 2 秒更新一次
    setInterval(updateFileContent, 2000);

    // 页面加载时立即更新
    updateFileContent();
</script>
</body>
</html>

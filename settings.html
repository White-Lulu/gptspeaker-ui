<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings-OwO</title>
    <style>

        .container {
        display: flex;
        gap: 30px;
        margin-top: 20px;
        padding: 20px;
        min-height: 400px; /* è®©æ•´ä½“åŒºå—æ›´é•¿ */
        }  

        .navbar {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 10px 20px;
                    border-bottom:2px solid #ccc;
                }

        .emoji {
            font-size: 24px; /* è¡¨æƒ…å¤§å° */
            margin-right: 10px; /* å³ä¾§é—´è· */
        }

        .nav-links {
            display: flex;
            gap: 15px; /* æ–‡å­—å—ä¹‹é—´çš„é—´è· */
        }

        
        .nav-links .noactive-nav {
                border: 2px solid;  /* æ·»åŠ è¾¹æ¡† */
                border-radius: 5px; /* ä¿æŒä¸å…¶ä»–æŒ‰é’®ä¸€è‡´çš„åœ†è§’ */
                color: black;       /* ä¿æŒæ–‡å­—é¢œè‰² */
        }

        .nav-links a {
            text-decoration: none; /* å»æ‰è¶…é“¾æ¥çš„ä¸‹åˆ’çº¿ */
            color: black; /* æ–‡å­—é¢œè‰² */
            font-size: 16px;
            padding: 5px 10px; /* å†…è¾¹è· */
        }

        .nav-links4{
            /* åªæœ‰æœ€åä¸€ä¸ªæœ‰èƒŒæ™¯è‰² */
            color:#ffffff;
            border-radius: 5px; /* è®©æŒ‰é’®åœ†è§’ */
            border: 2px solid;  /* æ·»åŠ è¾¹æ¡† */
            border-radius: 5px; /* ä¿æŒä¸å…¶ä»–æŒ‰é’®ä¸€è‡´çš„åœ†è§’ */
            color: rgb(255, 255, 255);       /* ä¿æŒæ–‡å­—é¢œè‰² */
        }

        /* ç¬¬ä¸€åˆ—ï¼ˆå·¦ä¾§ï¼‰ */
        .left-column1 {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 580px;   /* æ·»åŠ è¿™è¡Œï¼šé™åˆ¶æœ€å¤§é«˜åº¦ */
            max-height: 580px;
            border:2px solid #ccc;
            border-radius: 5px;
        }
        .right-column1 {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            min-height: 540px;
            max-height: 580px;
            border:2px solid #ccc;
            border-radius: 5px;
            
        }
        .right-column2 {
            flex: 2;
            display: flex;
            flex-direction: column;
            padding: 40px;
            min-height: 540px;
            max-height: 580px;
            border:2px solid #ccc;
            border-radius: 5px;
            
        }

        .input-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 1px;
        }

        .input-group-item {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-group-item label {
            margin-bottom: 11px;
        }

        .input-group-item input {
            width: 100%;
            min-height: 38px;
            box-sizing: border-box;
        }

        form {
            min-width: 200px; /* è®¾ç½®è¡¨å•æœ€å¤§å®½åº¦ */
            margin: 20px auto; /* å±…ä¸­ï¼Œä¸¤è¾¹è‡ªåŠ¨åˆ†é… marginï¼Œä¸Šæ–¹ç•™ 40px è·ç¦» */
            border-radius: 10px;
        }


        h1 {
            font-size: 24px;
            margin-bottom: 50px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        select {
            width: 100%;
            height: 40px;
            margin-bottom: 20px;
            border:2px solid #ccc;
            border-radius: 5px;

        }

        option:hover {
            background-color:#ccc; /*var(--main-color); /* ä½¿ç”¨ CSS å˜é‡ */
            color: rgb(0, 0, 0); /* æ‚¬åœé€‰é¡¹çš„æ–‡æœ¬é¢œè‰² */
        }

        input[type="text"] {
            width: 100%;
            height: 35px;
            margin-bottom: 20px;
            border:2px solid #ccc;
            border-radius: 5px;
        }

        input[type="color"] {
            width: 100%;
            height: 40px;
            margin-bottom: 22px;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 37px;
            accent-color: var(--main-color); /* ä½¿ç”¨CSSå˜é‡æ§åˆ¶é¢œè‰² */
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

    </style>
</head>
<body>
    <div class="navbar">
        <span class="emoji">ğŸ˜Š</span> <!-- å·¦ä¾§è¡¨æƒ… -->
        <div class="nav-links">
            <a href="speaker.html" class="noactive-nav">Speaker</a>
            <a href="news.html" class="noactive-nav">News</a>
            <a href="notes.html" class="noactive-nav">Notes</a>
            <a href="#" class="nav-links4">Setting</a> <!-- æœ€åä¸€ä¸ªæœ‰åº•è‰² -->
        </div>
    </div>
    <!-- ä¸»å®¹å™¨ï¼šåŒ…å«ä¸¤åˆ— -->
    <div class="container">
        <!-- ç¬¬ä¸€åˆ—ï¼ˆå·¦ä¾§å¤§åŒºå—ï¼‰ -->
        <div class="left-column1">
        <form id="style-settings">
            <h1 style="text-align: center">Theme Setting</h1>
            <label for="background-color">BackgroundColor:</label>
            <input type="color" id="background-color" name="background-color" value="#f4f4f4">

            <label for="main-color">MainColor:</label>
            <input type="color" id="main-color" name="main-color" value="#000000">

            <label for="sub-color">SubColor:</label>
            <input type="color" id="sub-color" name="sub-color" value="#000000">

            <label for="opacity">Opacity:</label>
            <input type="range" id="opacity" name="opacity" min="0" max="1" step="0.05" value="1">

            <button type="button" onclick="saveSettings()">Save !</button>
        </form>
        </div>

        <!-- ç¬¬äºŒåˆ—ï¼ˆå³ä¾§åŒ…å«ä¸¤è¡ŒåŒºå—ï¼‰ -->
        <div class="right-column1">
        <form>
            <h1 style="text-align: center">Speaker Setting</h1>
            <div class="input-group">
                <div class="input-group-item">
                    <label for="chatname">ChatName:</label>
                    <input type="text" id="chatname" name="chatname" value="ğŸ˜Š">
                </div>
                <div class="input-group-item">
                    <label for="username">UserName:</label>
                    <input type="text" id="username" name="username" value="ğŸ˜">
                </div>
            </div>
            <label for="voice">Voice:</label>
            <select id="voice" name="voice" value="zh-CN-XiaoxiaoNeural">
                <option value="zh-CN-XiaoxiaoNeural">[å¥³]Xiaoxiao</option>
                <option value="zh-CN-YunxiNeural">[ç”·]Yunxi</option>
                <option value="zh-CN-YunjianNeural">[ç”·]Yunjian</option>
                <option value="zh-CN-XiaoyiNeural">[å¥³]Xiaoyi</option>
                <option value="zh-CN-XiaochenNeural">[å¥³]Xiaochen</option>
                <option value="zh-CN-guangxi-YunqiNeural">[ç”·]å¹¿è¥¿</option>
                <option value="zh-CN-henan-YundengNeural">[ç”·]ä¸­åŸ</option>
                <option value="zh-CN-liaoning-XiaobeiNeural">[å¥³]ä¸œåŒ—</option>
                <option value="zh-CN-liaoning-YunbiaoNeural">[ç”·]ä¸œåŒ—</option>
                <option value="zh-CN-shaanxi-XiaoniNeural">[å¥³]é™•è¥¿</option>
                <option value="zh-CN-shandong-YunxiangNeural">[ç”·]å‰æ™®</option>
                <option value="zh-CN-sichuan-YunxiNeural">[ç”·]è¥¿å—</option>
            </select>
            
            <label>DeepSeek Model:</label>
            <select id="deepseekmodel" name="deepseekmodel" value="deepseek-chat">
                <option value="deepseek-chat">V3</option>
                <option value="deepseek-reasoner">R1</option>
            </select>

            <label>OpenAI Model:</label>
            <select id="openaimodel" name="openaimodel" value="gpt-4o">
                <option value="gpt-4o-mini">gpt-4o-mini</option>
                <option value="gpt-4o">gpt-4o</option>
                <option value="o1-mini">o1-mini</option>
                <option value="o1-preview">o1-preview</option>
            </select>
            <button type="button" onclick="saveSettings1()">Save !</button>
        </form>
        </div>
        <div class="right-column1">
            <form>
                <h1 style="text-align: center">Notes Setting</h1>
                <label for="voice">Notes:</label>
                <select id="note" name="note" value="">
                    <option value="">O.o</option>
                </select>
                <button type="button" onclick="deletenotes()">Delete !</button>
            </form>
        </div>    
        <div class="right-column2"></div>
    </div>
    <script>
    
    function saveSettings() {
    const backgroundColor = document.getElementById('background-color').value;
    const mainColor = document.getElementById('main-color').value;
    const subColor = document.getElementById('sub-color').value;
    const opacity = document.getElementById('opacity').value;

    // ä¿å­˜è®¾ç½®åˆ° localStorage
    localStorage.setItem('backgroundColor', backgroundColor);
    localStorage.setItem('mainColor', mainColor);
    localStorage.setItem('subColor', subColor);
    localStorage.setItem('opacity', opacity);

    alert('Settings saved!');
}

    function saveSettings1() {
        const voice = document.getElementById('voice').value;
        const chatname = document.getElementById('chatname').value;
        const username = document.getElementById('username').value;
        const deepseekmodel = document.getElementById('deepseekmodel').value;
        const openaimodel = document.getElementById('openaimodel').value;

        // ä¿å­˜è®¾ç½®åˆ° localStorage
        localStorage.setItem('voice',voice);
        localStorage.setItem('chatname', chatname);
        localStorage.setItem('username', username);
        localStorage.setItem('deepseekmodel', deepseekmodel);
        localStorage.setItem('openaimodel', openaimodel);

        alert('Settings saved!');
    }
    
    function loadNotesForSettings() {
    console.log("åŠ è½½è®¾ç½®ç•Œé¢çš„ notes");
    const notes = JSON.parse(localStorage.getItem("sortedNotes")) || [];
    const select = document.getElementById("note");

    select.innerHTML = '<option value="">O.o</option>';

    notes.forEach((note, index) => {
        const option = document.createElement("option");
        option.value = `${note.title}`;
        option.textContent = `${note.title}`;
        select.appendChild(option);
    });
}

        // **3. åˆ é™¤é€‰ä¸­çš„ Note**
        function deletenotes() {
    const select = document.getElementById("note");
    const selectedTitle = select.value;

    if (selectedTitle === "") {
        alert("O.o");
        return;
    }

    let notes = JSON.parse(localStorage.getItem("notes")) || [];
    // æ ¹æ®æ ‡é¢˜æŸ¥æ‰¾å¹¶åˆ é™¤ç¬”è®°
    const noteIndex = notes.findIndex(note => note.title === selectedTitle);
    
    if (noteIndex !== -1) {
        notes.splice(noteIndex, 1); // åˆ é™¤æ‰¾åˆ°çš„ç¬”è®°
        
        // æ›´æ–° localStorage
        localStorage.setItem("notes", JSON.stringify(notes));
        localStorage.setItem("sortedNotes", JSON.stringify(notes));

        alert("Successfully deleted !");
        loadNotesForSettings(); // é‡æ–°åŠ è½½ä¸‹æ‹‰æ¡†
    } else {
        alert("We can't find this note.");
    }
}
    function applyMainColor(color) {
        document.documentElement.style.setProperty('--main-color', color);
    }

    window.onload = function() {

    const savedBackgroundColor = localStorage.getItem('backgroundColor') || '#f4f4f4';
    const savedMainColor = localStorage.getItem('mainColor') || '#447de18f';
    const savedSubColor = localStorage.getItem('subColor') || '#ccc';
    const savedOpacity = localStorage.getItem('opacity') || '1'; // è¯»å–é€æ˜åº¦

    // ä» localStorage ä¸­è¯»å–ä¿å­˜çš„å€¼
    const savedVoice = localStorage.getItem('voice') || 'zh-CN-XiaoxiaoNeural';
    const savedChatname = localStorage.getItem('chatname') || 'ğŸ˜Š';
    const savedUsername = localStorage.getItem('username') || 'ğŸ˜'; 
    const savedDeepseekmodel = localStorage.getItem('deepseekmodel') || 'v3';
    const savedOpenaimodel = localStorage.getItem('openaimodel') || 'gpt-4o';

    // å°†ä¿å­˜çš„å€¼åº”ç”¨åˆ°è¡¨å•å…ƒç´ ä¸­
    document.getElementById('voice').value = savedVoice;
    document.getElementById('chatname').value = savedChatname;
    document.getElementById('username').value = savedUsername;
    document.getElementById('deepseekmodel').value = savedDeepseekmodel;
    document.getElementById('openaimodel').value = savedOpenaimodel;
    
    document.getElementById('main-color').value = savedMainColor;
    applyMainColor(savedMainColor);

    document.getElementById('main-color').addEventListener('input', function () {
    applyMainColor(this.value);
    });

    // åº”ç”¨èƒŒæ™¯è‰²
    document.body.style.backgroundColor = savedBackgroundColor;
    document.querySelectorAll('.noactive-nav').forEach(a => {
        a.style.borderColor = savedBackgroundColor;
    });
    // åº”ç”¨ä¸»è‰²åˆ°æ‰€æœ‰æŒ‰é’®
    document.querySelectorAll('button').forEach(button => {
        button.style.backgroundColor = savedMainColor;
    });

    // åº”ç”¨è¾…åŠ©è‰²
    document.querySelectorAll('input[type="text"]').forEach(input => {
        input.style.borderColor = savedSubColor;
    });
    document.querySelectorAll('select').forEach(select => {
        select.style.borderColor = savedSubColor;
    });
    document.querySelector('.left-column1').style.borderColor = savedSubColor;
    document.querySelectorAll('.right-column1').forEach(div => {
        div.style.borderColor = savedSubColor;});
    document.querySelector('.navbar').style.borderBottomColor = savedSubColor;
    document.querySelector('.nav-links4').style.backgroundColor = savedSubColor;
    document.querySelector('.nav-links4').style.borderColor = savedSubColor;

    // **åŒæ­¥æ›´æ–° input é¢œè‰²é€‰æ‹©æ¡†çš„å€¼**
    document.getElementById('background-color').value = savedBackgroundColor;
    document.getElementById('main-color').value = savedMainColor;
    document.getElementById('sub-color').value = savedSubColor;

     // **å®æ—¶ç›‘å¬é€æ˜åº¦è°ƒæ•´**
     document.getElementById('opacity').addEventListener('input', function() {
        applyOpacity(this.value);
    });

    // è®¡ç®—èƒŒæ™¯é¢œè‰²äº®åº¦å¹¶è°ƒæ•´å­—ä½“é¢œè‰²
    document.querySelector('.nav-links4').style.color = getContrastColor(savedSubColor);
    
    // åº”ç”¨é€æ˜åº¦
    applyOpacity(savedOpacity);

     // ç»‘å®šæ»‘åŠ¨æ¡äº‹ä»¶ï¼Œä½¿ç”¨æˆ·è°ƒæ•´æ—¶å®æ—¶ç”Ÿæ•ˆ
     document.getElementById('opacity').addEventListener('input', function() {
        applyOpacity(this.value);
    });

    // è®¾ç½®æ»‘åŠ¨æ¡çš„å€¼ä¸ºä¿å­˜çš„é€æ˜åº¦
    document.getElementById('opacity').value = savedOpacity;

    // æ·»åŠ è¿™ä¸€è¡Œæ¥åŠ è½½ç¬”è®°åˆ—è¡¨
    loadNotesForSettings();
};

// åº”ç”¨é€æ˜åº¦
function applyOpacity(opacity) {
    document.querySelectorAll('input,select').forEach(el => {
        // å…ˆè·å–åŸå§‹èƒŒæ™¯é¢œè‰²
        let bgColor = window.getComputedStyle(el).backgroundColor;
        let rgbaColor = convertToRGBA(bgColor, opacity);
        el.style.backgroundColor = rgbaColor;
    });
}

// é¢œè‰²è½¬æ¢å‡½æ•°ï¼šå°† `rgb(r, g, b)` æˆ– `#xxxxxx` è½¬æ¢ä¸º `rgba(r, g, b, opacity)`
function convertToRGBA(color, opacity) {
    let r, g, b;
    
    if (color.startsWith("rgb")) {
        // è§£æ `rgb(r, g, b)` å½¢å¼
        let rgbValues = color.match(/\d+/g);
        r = parseInt(rgbValues[0]);
        g = parseInt(rgbValues[1]);
        b = parseInt(rgbValues[2]);
    } else if (color.startsWith("#")) {
        // è§£æ `#RRGGBB` å½¢å¼
        let hex = color.replace("#", "");
        if (hex.length === 3) {
            hex = hex.split("").map(c => c + c).join("");
        }
        r = parseInt(hex.substring(0, 2), 16);
        g = parseInt(hex.substring(2, 4), 16);
        b = parseInt(hex.substring(4, 6), 16);
    } else {
        // é»˜è®¤è¿”å›ç™½è‰²
        return `rgba(255, 255, 255, ${opacity})`;
    }
    
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}

// è®¡ç®—é¢œè‰²äº®åº¦å¹¶è¿”å›åˆé€‚çš„å¯¹æ¯”è‰²
function getContrastColor(hexColor) {
    // ç¡®ä¿ hexColor æ˜¯ #RRGGBB å½¢å¼
    hexColor = hexColor.replace(/^#/, '');
    if (hexColor.length === 3) {
        hexColor = hexColor.split('').map(c => c + c).join('');
    }

    // è§£æ RGB å€¼
    let r = parseInt(hexColor.substring(0, 2), 16) / 255;
    let g = parseInt(hexColor.substring(2, 4), 16) / 255;
    let b = parseInt(hexColor.substring(4, 6), 16) / 255;

    // è®¡ç®—ç›¸å¯¹äº®åº¦ï¼ˆç¬¦åˆ W3C WCAG æ ‡å‡†ï¼‰
    let luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;

    // äº®åº¦è¾ƒé«˜ï¼ˆèƒŒæ™¯è¾ƒæµ…ï¼‰ï¼Œç”¨é»‘è‰²ï¼›äº®åº¦è¾ƒä½ï¼ˆèƒŒæ™¯è¾ƒæ·±ï¼‰ï¼Œç”¨ç™½è‰²
    return luminance > 0.5 ? '#000000' : '#ffffff';

};
</script>
<script>
async function sendSettings() {
    try {
        // è·å–è¡¨å•æ•°æ®
        const voice = document.getElementById('voice').value.trim();
        const chatname = document.getElementById('chatname').value.trim();
        const username = document.getElementById('username').value.trim();
        const deepseekmodel = document.getElementById('deepseekmodel').value.trim();
        const openaimodel = document.getElementById('openaimodel').value.trim();

        // å‘é€ POST è¯·æ±‚
        const response = await fetch('http://localhost:5000/submit_settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                voice: voice,
                chatname: chatname,
                username: username,
                deepseekmodel: deepseekmodel,
                openaimodel: openaimodel
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Success:', data);
    } catch (error) {
        console.error('Error:', error);
        alert('è®¾ç½®æ›´æ–°å¤±è´¥ï¼š' + error.message);
    }
}

// ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
document.querySelector('button[onclick="saveSettings1()"]').addEventListener('click', function(event) {
    event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
    sendSettings(); // è°ƒç”¨å‘é€è¯·æ±‚çš„å‡½æ•°
});
    </script>
</body>
</html>
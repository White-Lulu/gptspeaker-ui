<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes-OwO</title>
    <style>
input, textarea {
    font-family: Arial, sans-serif;
}

.navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 2px solid #ccc; /* åªæ˜¾ç¤ºä¸‹è¾¹æ¡† */
        }

.emoji {
    font-size: 24px; /* è¡¨æƒ…å¤§å° */
    margin-right: 10px; /* å³ä¾§é—´è· */
}

.nav-links {
    display: flex;
    gap: 15px; /* æ–‡å­—å—ä¹‹é—´çš„é—´è· */
}

.nav-links .active-nav {
        border: 2px solid;  /* æ·»åŠ è¾¹æ¡† */
        border-radius: 5px; /* ä¿æŒä¸å…¶ä»–æŒ‰é’®ä¸€è‡´çš„åœ†è§’ */
        color: black;       /* ä¿æŒæ–‡å­—é¢œè‰² */
}

.nav-links .noactive-nav {
        border: 2px solid;  /* æ·»åŠ è¾¹æ¡† */
        border-radius: 5px; /* ä¿æŒä¸å…¶ä»–æŒ‰é’®ä¸€è‡´çš„åœ†è§’ */
        color: black;       /* ä¿æŒæ–‡å­—é¢œè‰² */
}
    
.nav-links a {
    text-decoration: none; /* å»æ‰è¶…é“¾æ¥çš„ä¸‹åˆ’çº¿ */
    color: black; /* æ–‡å­—é¢œè‰² */
    font-size: 16px;
    padding: 5px 10px; /* å†…è¾¹è· */
}

.nav-links4{
     /* åªæœ‰æœ€åä¸€ä¸ªæœ‰èƒŒæ™¯è‰² */
    color:#ffffff;
    border-radius: 5px; /* è®©æŒ‰é’®åœ†è§’ */
    border: 2px solid;  /* æ·»åŠ è¾¹æ¡† */
    border-radius: 5px; /* ä¿æŒä¸å…¶ä»–æŒ‰é’®ä¸€è‡´çš„åœ†è§’ */
    color: rgb(255, 255, 255);       /* ä¿æŒæ–‡å­—é¢œè‰² */
}

.container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }

    /* notes-list å®¹å™¨æ ·å¼ */
    #notes-list {
        display: flex;
        flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
        gap: 20px; /* æ¯ä¸ª note ä¹‹é—´çš„é—´è· */
        justify-content: flex-start; /* å·¦å¯¹é½ */
        width: 100%; /* å æ»¡çˆ¶å®¹å™¨å®½åº¦ */
        max-width: 1200px; /* é™åˆ¶æœ€å¤§å®½åº¦ */
    }

    /* æ¯ä¸ª note çš„å®¹å™¨æ ·å¼ */
    .note-container {
        flex: 1 1 calc(20% - 20px); /* æ¯æ’ 5 æ¡ï¼Œæ¯æ¡å  20% å®½åº¦ï¼Œå‡å»é—´è· */
        box-sizing: border-box; /* é˜²æ­¢ padding å’Œ border å½±å“å®½åº¦ */
        border-radius: 5px;
        padding: 15px;
        background-color: #f9f9f9;
        border:2px solid #ccc;
        min-width: 200px; /* æœ€å°å®½åº¦ï¼Œé˜²æ­¢å†…å®¹è¿‡å°æ—¶å˜å½¢ */
    }

    /* note æ ‡é¢˜æ ·å¼ */
    .note-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    /* note å†…å®¹æ ·å¼ */
    .note-content {
        font-size: 14px;
        margin-bottom: 10px;
    }

    /* note æ—¥æœŸæ ·å¼ */
    .note-date {
        font-size: 12px;
        color: #666;
    }
</style>
</style>
</head>
<body>
    <div class="navbar">
        <span class="emoji">ğŸ˜Š</span> <!-- å·¦ä¾§è¡¨æƒ… -->
        <div class="nav-links">
            <a href="speaker.html" class="noactive-nav">Speaker</a>
            <a href="news.html" class="noactive-nav">News</a>
            <a href="#" class="active-nav">Notes</a>
            <a class="nav-links4" href="settings.html">Setting</a> <!-- æœ€åä¸€ä¸ªæœ‰åº•è‰² -->
        </div>
    </div>
     <!-- ä¸»å®¹å™¨ï¼šåŒ…å«ä¸¤åˆ— -->
     <div class="container">
        <div id="notes-list"></div>
    </div>
<script>
 // åˆå¹¶åçš„ window.onload å‡½æ•°
window.onload = function() {
    console.log("Window loaded"); // è°ƒè¯•ä¿¡æ¯

    // ç¬¬ä¸€éƒ¨åˆ†é€»è¾‘ï¼šåº”ç”¨ä¿å­˜çš„è®¾ç½®
    const savedBackgroundColor = localStorage.getItem('backgroundColor') || '#f4f4f4';
    const savedMainColor = localStorage.getItem('mainColor') || '#447de18f';
    const savedSubColor = localStorage.getItem('subColor') || '#ccc';
    const savedOpacity = localStorage.getItem('opacity') || '1'; // è¯»å–é€æ˜åº¦

    // åº”ç”¨èƒŒæ™¯è‰²
    document.body.style.backgroundColor = savedBackgroundColor;
    document.querySelectorAll('.noactive-nav').forEach(a => {
        a.style.borderColor = savedBackgroundColor;
    });

    // åº”ç”¨ä¸»è‰²
    document.querySelector('.active-nav').style.borderColor = savedMainColor;

    // åº”ç”¨è¾…åŠ©è‰²
    document.querySelector('.navbar').style.borderBottomColor = savedSubColor;
    document.querySelector('.nav-links4').style.backgroundColor = savedSubColor;
    document.querySelector('.nav-links4').style.borderColor = savedSubColor;

    // è®¡ç®—èƒŒæ™¯é¢œè‰²äº®åº¦å¹¶è°ƒæ•´å­—ä½“é¢œè‰²
    document.querySelector('.nav-links4').style.color = getContrastColor(savedSubColor);

    // ç¬¬äºŒéƒ¨åˆ†é€»è¾‘ï¼šåŠ è½½ notes æ•°æ®
    loadNotes();
};

// ä» localStorage ä¸­è¯»å– notes æ•°æ®
function loadNotes() {
    console.log("loadNotes called"); // è°ƒè¯•ä¿¡æ¯
    const notesList = document.getElementById("notes-list");
    const notes = JSON.parse(localStorage.getItem("notes")) || [];
    console.log("Notes data:", notes); // æ‰“å° notes æ•°æ®

    // æŒ‰æ—¶é—´å€’åºæ’åˆ—
    notes.sort((a, b) => new Date(b.date) - new Date(a.date));

    // æ¸…ç©ºç°æœ‰å†…å®¹
    notesList.innerHTML = "";

    // å¦‚æœæ²¡æœ‰ notes æ•°æ®ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
    if (notes.length === 0) {
        notesList.innerHTML = "<p>No notes found.</p>";
        return;
    }

    // éå† notes æ•°æ®å¹¶å±•ç¤º
    notes.forEach(note => {
        if (!note.title || !note.content || !note.date) {
            console.error("Invalid note format:", note); // æ‰“å°é”™è¯¯æ ¼å¼
            return;
        }

        const noteDiv = document.createElement("div");
        noteDiv.className = "note-container";

        // è®¾ç½®åˆå§‹èƒŒæ™¯è‰²
        noteDiv.style.backgroundColor = "#f9f9f9"; // é»˜è®¤èƒŒæ™¯è‰²

        // è®¾ç½® borderColor
        noteDiv.style.borderColor = localStorage.getItem('subColor') || '#ccc';

        const title = document.createElement("div");
        title.className = "note-title";
        title.textContent = note.title;

        const content = document.createElement("div");
        content.className = "note-content";
        content.textContent = note.content;

        const date = document.createElement("div");
        date.className = "note-date";
        date.textContent = `Date: ${note.date}`;

        noteDiv.appendChild(title);
        noteDiv.appendChild(content);
        noteDiv.appendChild(date);

        notesList.appendChild(noteDiv);
    });

    // åº”ç”¨é€æ˜åº¦
    const savedOpacity = localStorage.getItem('opacity') || '1';
    applyOpacity(savedOpacity);

    // å­˜å‚¨æ’åºåçš„ notesï¼ˆå¸¦åºå·ï¼‰åˆ° localStorageï¼Œä¾› `settings.html` ä½¿ç”¨
    localStorage.setItem("sortedNotes", JSON.stringify(notes));
}

// åº”ç”¨é€æ˜åº¦
function applyOpacity(opacity) {
    document.querySelectorAll('.note-container').forEach(el => {
        // å…ˆè·å–åŸå§‹èƒŒæ™¯é¢œè‰²
        let bgColor = window.getComputedStyle(el).backgroundColor;
        let rgbaColor = convertToRGBA(bgColor, opacity);
        el.style.backgroundColor = rgbaColor;
    });
}

// é¢œè‰²è½¬æ¢å‡½æ•°ï¼šå°† `rgb(r, g, b)` æˆ– `#xxxxxx` è½¬æ¢ä¸º `rgba(r, g, b, opacity)`
function convertToRGBA(color, opacity) {
    let r, g, b;
    
    if (color.startsWith("rgb")) {
        // è§£æ `rgb(r, g, b)` å½¢å¼
        let rgbValues = color.match(/\d+/g);
        r = parseInt(rgbValues[0]);
        g = parseInt(rgbValues[1]);
        b = parseInt(rgbValues[2]);
    } else if (color.startsWith("#")) {
        // è§£æ `#RRGGBB` å½¢å¼
        let hex = color.replace("#", "");
        if (hex.length === 3) {
            hex = hex.split("").map(c => c + c).join("");
        }
        r = parseInt(hex.substring(0, 2), 16);
        g = parseInt(hex.substring(2, 4), 16);
        b = parseInt(hex.substring(4, 6), 16);
    } else {
        // é»˜è®¤è¿”å›ç™½è‰²
        return `rgba(255, 255, 255, ${opacity})`;
    }
    
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}

// è®¡ç®—é¢œè‰²äº®åº¦å¹¶è¿”å›åˆé€‚çš„å¯¹æ¯”è‰²
function getContrastColor(hexColor) {
    // ç¡®ä¿ hexColor æ˜¯ #RRGGBB å½¢å¼
    hexColor = hexColor.replace(/^#/, '');
    if (hexColor.length === 3) {
        hexColor = hexColor.split('').map(c => c + c).join('');
    }

    // è§£æ RGB å€¼
    let r = parseInt(hexColor.substring(0, 2), 16) / 255;
    let g = parseInt(hexColor.substring(2, 4), 16) / 255;
    let b = parseInt(hexColor.substring(4, 6), 16) / 255;

    // è®¡ç®—ç›¸å¯¹äº®åº¦ï¼ˆç¬¦åˆ W3C WCAG æ ‡å‡†ï¼‰
    let luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;

    // äº®åº¦è¾ƒé«˜ï¼ˆèƒŒæ™¯è¾ƒæµ…ï¼‰ï¼Œç”¨é»‘è‰²ï¼›äº®åº¦è¾ƒä½ï¼ˆèƒŒæ™¯è¾ƒæ·±ï¼‰ï¼Œç”¨ç™½è‰²
    return luminance > 0.5 ? '#000000' : '#ffffff';
}
</script>
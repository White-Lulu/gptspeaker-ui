<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes-OwO</title>
    <style>
input, textarea {
    font-family: Arial, sans-serif;
}

.navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 2px solid #ccc; /* 只显示下边框 */
        }

.emoji {
    font-size: 24px; /* 表情大小 */
    margin-right: 10px; /* 右侧间距 */
}

.nav-links {
    display: flex;
    gap: 15px; /* 文字块之间的间距 */
}

.nav-links .active-nav {
        border: 2px solid;  /* 添加边框 */
        border-radius: 5px; /* 保持与其他按钮一致的圆角 */
        color: black;       /* 保持文字颜色 */
}

.nav-links .noactive-nav {
        border: 2px solid;  /* 添加边框 */
        border-radius: 5px; /* 保持与其他按钮一致的圆角 */
        color: black;       /* 保持文字颜色 */
}
    
.nav-links a {
    text-decoration: none; /* 去掉超链接的下划线 */
    color: black; /* 文字颜色 */
    font-size: 16px;
    padding: 5px 10px; /* 内边距 */
}

.nav-links4{
     /* 只有最后一个有背景色 */
    color:#ffffff;
    border-radius: 5px; /* 让按钮圆角 */
    border: 2px solid;  /* 添加边框 */
    border-radius: 5px; /* 保持与其他按钮一致的圆角 */
    color: rgb(255, 255, 255);       /* 保持文字颜色 */
}

.container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }

    /* notes-list 容器样式 */
    #notes-list {
        display: flex;
        flex-wrap: wrap; /* 允许换行 */
        gap: 20px; /* 每个 note 之间的间距 */
        justify-content: flex-start; /* 左对齐 */
        width: 100%; /* 占满父容器宽度 */
        max-width: 1200px; /* 限制最大宽度 */
    }

    /* 每个 note 的容器样式 */
    .note-container {
        flex: 1 1 calc(20% - 20px); /* 每排 5 条，每条占 20% 宽度，减去间距 */
        box-sizing: border-box; /* 防止 padding 和 border 影响宽度 */
        border-radius: 5px;
        padding: 15px;
        background-color: #f9f9f9;
        border:2px solid #ccc;
        min-width: 200px; /* 最小宽度，防止内容过小时变形 */
    }

    /* note 标题样式 */
    .note-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    /* note 内容样式 */
    .note-content {
        font-size: 14px;
        margin-bottom: 10px;
    }

    /* note 日期样式 */
    .note-date {
        font-size: 12px;
        color: #666;
    }
</style>
</style>
</head>
<body>
    <div class="navbar">
        <span class="emoji">😊</span> <!-- 左侧表情 -->
        <div class="nav-links">
            <a href="speaker.html" class="noactive-nav">Speaker</a>
            <a href="news.html" class="noactive-nav">News</a>
            <a href="#" class="active-nav">Notes</a>
            <a class="nav-links4" href="settings.html">Setting</a> <!-- 最后一个有底色 -->
        </div>
    </div>
     <!-- 主容器：包含两列 -->
     <div class="container">
        <div id="notes-list"></div>
    </div>
<script>
 // 合并后的 window.onload 函数
window.onload = function() {
    console.log("Window loaded"); // 调试信息

    // 第一部分逻辑：应用保存的设置
    const savedBackgroundColor = localStorage.getItem('backgroundColor') || '#f4f4f4';
    const savedMainColor = localStorage.getItem('mainColor') || '#447de18f';
    const savedSubColor = localStorage.getItem('subColor') || '#ccc';
    const savedOpacity = localStorage.getItem('opacity') || '1'; // 读取透明度

    // 应用背景色
    document.body.style.backgroundColor = savedBackgroundColor;
    document.querySelectorAll('.noactive-nav').forEach(a => {
        a.style.borderColor = savedBackgroundColor;
    });

    // 应用主色
    document.querySelector('.active-nav').style.borderColor = savedMainColor;

    // 应用辅助色
    document.querySelector('.navbar').style.borderBottomColor = savedSubColor;
    document.querySelector('.nav-links4').style.backgroundColor = savedSubColor;
    document.querySelector('.nav-links4').style.borderColor = savedSubColor;

    // 计算背景颜色亮度并调整字体颜色
    document.querySelector('.nav-links4').style.color = getContrastColor(savedSubColor);

    // 第二部分逻辑：加载 notes 数据
    loadNotes();
};

// 从 localStorage 中读取 notes 数据
function loadNotes() {
    console.log("loadNotes called"); // 调试信息
    const notesList = document.getElementById("notes-list");
    const notes = JSON.parse(localStorage.getItem("notes")) || [];
    console.log("Notes data:", notes); // 打印 notes 数据

    // 按时间倒序排列
    notes.sort((a, b) => new Date(b.date) - new Date(a.date));

    // 清空现有内容
    notesList.innerHTML = "";

    // 如果没有 notes 数据，显示提示信息
    if (notes.length === 0) {
        notesList.innerHTML = "<p>No notes found.</p>";
        return;
    }

    // 遍历 notes 数据并展示
    notes.forEach(note => {
        if (!note.title || !note.content || !note.date) {
            console.error("Invalid note format:", note); // 打印错误格式
            return;
        }

        const noteDiv = document.createElement("div");
        noteDiv.className = "note-container";

        // 设置初始背景色
        noteDiv.style.backgroundColor = "#f9f9f9"; // 默认背景色

        // 设置 borderColor
        noteDiv.style.borderColor = localStorage.getItem('subColor') || '#ccc';

        const title = document.createElement("div");
        title.className = "note-title";
        title.textContent = note.title;

        const content = document.createElement("div");
        content.className = "note-content";
        content.textContent = note.content;

        const date = document.createElement("div");
        date.className = "note-date";
        date.textContent = `Date: ${note.date}`;

        noteDiv.appendChild(title);
        noteDiv.appendChild(content);
        noteDiv.appendChild(date);

        notesList.appendChild(noteDiv);
    });

    // 应用透明度
    const savedOpacity = localStorage.getItem('opacity') || '1';
    applyOpacity(savedOpacity);

    // 存储排序后的 notes（带序号）到 localStorage，供 `settings.html` 使用
    localStorage.setItem("sortedNotes", JSON.stringify(notes));
}

// 应用透明度
function applyOpacity(opacity) {
    document.querySelectorAll('.note-container').forEach(el => {
        // 先获取原始背景颜色
        let bgColor = window.getComputedStyle(el).backgroundColor;
        let rgbaColor = convertToRGBA(bgColor, opacity);
        el.style.backgroundColor = rgbaColor;
    });
}

// 颜色转换函数：将 `rgb(r, g, b)` 或 `#xxxxxx` 转换为 `rgba(r, g, b, opacity)`
function convertToRGBA(color, opacity) {
    let r, g, b;
    
    if (color.startsWith("rgb")) {
        // 解析 `rgb(r, g, b)` 形式
        let rgbValues = color.match(/\d+/g);
        r = parseInt(rgbValues[0]);
        g = parseInt(rgbValues[1]);
        b = parseInt(rgbValues[2]);
    } else if (color.startsWith("#")) {
        // 解析 `#RRGGBB` 形式
        let hex = color.replace("#", "");
        if (hex.length === 3) {
            hex = hex.split("").map(c => c + c).join("");
        }
        r = parseInt(hex.substring(0, 2), 16);
        g = parseInt(hex.substring(2, 4), 16);
        b = parseInt(hex.substring(4, 6), 16);
    } else {
        // 默认返回白色
        return `rgba(255, 255, 255, ${opacity})`;
    }
    
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}

// 计算颜色亮度并返回合适的对比色
function getContrastColor(hexColor) {
    // 确保 hexColor 是 #RRGGBB 形式
    hexColor = hexColor.replace(/^#/, '');
    if (hexColor.length === 3) {
        hexColor = hexColor.split('').map(c => c + c).join('');
    }

    // 解析 RGB 值
    let r = parseInt(hexColor.substring(0, 2), 16) / 255;
    let g = parseInt(hexColor.substring(2, 4), 16) / 255;
    let b = parseInt(hexColor.substring(4, 6), 16) / 255;

    // 计算相对亮度（符合 W3C WCAG 标准）
    let luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;

    // 亮度较高（背景较浅），用黑色；亮度较低（背景较深），用白色
    return luminance > 0.5 ? '#000000' : '#ffffff';
}
</script>